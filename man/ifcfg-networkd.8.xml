<?xml version="1.0" encoding="UTF-8"?>
<refentry xmlns="http://docbook.org/ns/docbook" version="5.0" xml:id="ifcfg-networkd" xml:lang="en">
  <refmeta>
    <refentrytitle>ifcfg-networkd</refentrytitle>
    <manvolnum>8</manvolnum>
    <refmiscinfo class="source">raw-disk-image-installer %version%</refmiscinfo>
    <refmiscinfo class="manual">ifcfg-networkd</refmiscinfo>
  </refmeta>

  <refnamediv>
    <refname>ifcfg-networkd</refname>
    <refname>ifcfg-networkd.service</refname>
    <refpurpose>Generate systemd-networkd configuration from ifcfg commandline options</refpurpose>
  </refnamediv>

  <refsynopsisdiv>
    <cmdsynopsis>
      <command>ifcfg-networkd.service</command>
    </cmdsynopsis>
    <cmdsynopsis>
      <command>ifcfg-networkd</command>
      <arg choice="opt" rep="repeat"><replaceable>IFCFG_STRING</replaceable></arg>
    </cmdsynopsis>
  </refsynopsisdiv>

  <refsect1>
    <title>Description</title>
    <para>
      <command>ifcfg-networkd</command> is a
      <citerefentry>
        <refentrytitle>systemd</refentrytitle><manvolnum>1</manvolnum>
      </citerefentry> service, which parses network configuration
      parameters passed via the kernel command line (specifically the
      openSUSE <literal>linuxrc</literal> style <option>ifcfg</option>
      option) and generates transient configuration files for
      <citerefentry><refentrytitle>systemd-networkd</refentrytitle><manvolnum>8</manvolnum></citerefentry>.
    </para>
    <para>
      The program reads from <filename>/proc/cmdline</filename> by default. It looks for all occurrences of
      <literal>ifcfg=</literal>, parses the arguments according to the syntax defined below, and writes
      corresponding <literal>.network</literal> files to <filename>/run/systemd/network/</filename>.
    </para>
    <para>
      If an argument is provided to the command, it is treated as a quoted kernel command line string
      for testing purposes, overriding the read from <filename>/proc/cmdline</filename>.
    </para>
  </refsect1>

  <refsect1>
    <title>Kernel Command Line Syntax</title>
    <para>
      The <option>ifcfg</option> option follows the format used by openSUSE's <literal>linuxrc</literal>.
    </para>

    <refsect2>
      <title>DHCP Configuration</title>
      <para>
        <synopsis>ifcfg=<replaceable>interface</replaceable>=dhcp*[,rfc2132]</synopsis>
      </para>
      <variablelist>
        <varlistentry>
          <term><literal>dhcp</literal></term>
          <listitem><para>Enables both IPv4 and IPv6 DHCP.</para></listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>dhcp4</literal></term>
          <listitem><para>Enables only IPv4 DHCP.</para></listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>dhcp6</literal></term>
          <listitem><para>Enables only IPv6 DHCP.</para></listitem>
        </varlistentry>
        <varlistentry>
          <term><literal>rfc2132</literal></term>
          <listitem>
            <para>
              Configures the DHCP client to send the MAC address as the client identifier.
              This maps to <literal>ClientIdentifier=mac</literal> in the generated systemd configuration.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Static Configuration</title>
      <para>
        <synopsis>ifcfg=<replaceable>interface</replaceable>=<replaceable>IP_LIST</replaceable>,<replaceable>GW_LIST</replaceable>,<replaceable>DNS_LIST</replaceable>,<replaceable>DOMAIN_LIST</replaceable></synopsis>
      </para>
      <para>
        Lists (IPs, Gateways, DNS, Domains) are space-separated. If a list contains spaces,
        the entire <option>ifcfg</option> string must be quoted on the kernel command line.
      </para>
      <variablelist>
        <varlistentry>
          <term><replaceable>IP_LIST</replaceable></term>
          <listitem><para>IP addresses in <literal>address/prefix</literal> notation (e.g., <literal>192.168.1.5/24</literal>).</para></listitem>
        </varlistentry>
        <varlistentry>
          <term><replaceable>GW_LIST</replaceable></term>
          <listitem><para>List of default gateways.</para></listitem>
        </varlistentry>
        <varlistentry>
          <term><replaceable>DNS_LIST</replaceable></term>
          <listitem><para>List of DNS servers.</para></listitem>
        </varlistentry>
      </variablelist>
    </refsect2>

    <refsect2>
      <title>Interface Specifications</title>
      <para>
        The <replaceable>interface</replaceable> specifier supports:
      </para>
      <itemizedlist>
        <listitem><para>Exact interface names (e.g., <literal>eth0</literal>).</para></listitem>
        <listitem><para>Exact interface names with .VlanID for vlan (e.g., <literal>eth0.vlanid</literal>).</para></listitem>
        <listitem><para>MAC addresses (e.g., <literal>12:34:56:78:9A:BC</literal>).</para></listitem>
        <listitem><para>Shell globs (e.g., <literal>eth*</literal>, <literal>*:BC</literal>).</para></listitem>
      </itemizedlist>
      <para>
	Vlans can be setup by adding a vlan id to the <replaceable>interface</replaceable> (e.g., <literal>eth0.vlanid</literal>).
	The interface will be configured for'tagged only' setups.
      </para>
    </refsect2>
  </refsect1>

  <refsect1>
    <title>Examples</title>

    <para>Run DHCP on <literal>eth0</literal>:</para>
    <programlisting>ifcfg=eth0=dhcp</programlisting>

    <para>Run DHCP on all interfaces matching the glob <literal>eth*</literal>:</para>
    <programlisting>ifcfg=eth*=dhcp</programlisting>

    <para>Configure a specific MAC address via DHCP using RFC2132 client ID:</para>
    <programlisting>ifcfg=00:11:22:33:44:55=dhcp,rfc2132</programlisting>

    <para>Static configuration (requires quoting on kernel command line due to spaces):</para>
    <programlisting>ifcfg="eth1=192.168.0.2/24 192.168.10.12/24,192.168.0.1,8.8.8.8,mydomain.com"</programlisting>
  </refsect1>

  <refsect1>
    <title>Files</title>
    <variablelist>
      <varlistentry>
        <term><filename>/proc/cmdline</filename></term>
        <listitem><para>Read to obtain kernel boot parameters.</para></listitem>
      </varlistentry>
      <varlistentry>
        <term><filename>/run/systemd/network/60-ifcfg-??.network</filename></term>
        <listitem><para>Generated configuration files. These files are transient and will be lost on reboot.</para></listitem>
      </varlistentry>
    </variablelist>
  </refsect1>

  <refsect1>
    <title>Exit Status</title>
    <para>
      <command>ifcfg-networkd</command> returns 0 on success, or a corresponding errno code on failures.
    </para>
  </refsect1>

  <refsect1>
    <title>See Also</title>
    <para>
      <citerefentry><refentrytitle>systemd-networkd</refentrytitle><manvolnum>8</manvolnum></citerefentry>,
      <citerefentry><refentrytitle>systemd.network</refentrytitle><manvolnum>5</manvolnum></citerefentry>,
      <citerefentry><refentrytitle>kernel-command-line</refentrytitle><manvolnum>7</manvolnum></citerefentry>
    </para>
  </refsect1>

</refentry>
